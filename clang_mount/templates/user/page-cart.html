{% extends 'user/base.html' %}
{% load static %}
{% block content %}
  <main class="main">
    <section class="mt-50 mb-50">
      <div class="container">
        <div class="row">
          <div class="col-lg-9">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th scope="col" class="h5">Shopping Bag</th>
                    <th scope="col" class="text-center">Price</th>
                    <th scope="col" class="text-center">Quantity</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">
                      <div class="d-flex align-items-center">
                        <img src="https://i.imgur.com/2DsA49b.webp" class="img-fluid rounded-3" style="width: 120px;" alt="Book" />
                        <div class="flex-column ms-4">
                          <p class="mb-2">Thinking, Fast and Slow</p>
                          <p class="mb-0">Daniel Kahneman</p>
                        </div>
                      </div>
                    </th>
                    <td class="align-middle text-center">
                      <p class="mb-0" style="font-weight: 500;">₹ 500</p>
                    </td>
                    <td class="align-middle text-center">
                      <div class="d-flex border number-input justify-content-between">
                        <button class="btn btn-link px-2" onclick="this.parentNode.querySelector('input[type=number]').stepDown()"><i class="fas fa-minus"></i></button>

                        <input id="form1" min="1" name="quantity" value="1" type="number" class="form-control p-0" style="width: 40px;border: none;" />

                        <button class="btn btn-link px-2" onclick="this.parentNode.querySelector('input[type=number]').stepUp()"><i class="fas fa-plus"></i></button>
                      </div>
                    </td>
                    <td class="align-middle text-center">
                      <a href="#!" class="text-danger"><i class="fas fa-trash fa-lg"></i></a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-lg-3 primary-sidebar">
            <div class="widget-category mb-30">
              <h5 class="section-title style-1 mb-30 wow fadeIn animated">Card total</h5>
              <div class="d-flex justify-content-between">
                <p>Sub-total</p>
                <p id="sub-total"></p>
              </div>
              <div class="d-flex justify-content-between">
                <p>Discount</p>
                <p id="discount"></p>
              </div>
              <div class="d-flex justify-content-between">
                <p>Shipping</p>
                <p id="shipping"></p>
              </div>
              <hr />
              <div class="d-flex justify-content-between">
                <p class="fw-bolder fs-5">Total</p>
                <p class="fs-5">
                  ₹ <span class="fw-bolder" id="total"></span>
                </p>
              </div>
              <div class="d-flex justify-content-center mt-30 btn-dark rounded">
                <a id="place-order-link" class="text-white fs-6 py-2 py-0" href="shop-cart.html"><span class="px-5">PLACE ORDER</span></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const quantityInput = document.getElementById('form1')
      const subTotalElement = document.getElementById('sub-total')
      const discountElement = document.getElementById('discount')
      const shippingElement = document.getElementById('shipping')
      const totalElement = document.getElementById('total')
    
      // Function to update the total based on the quantity
      function updateTotal() {
        const quantity = parseInt(quantityInput.value, 10)
        const price = 1000 // Replace with the actual price per item
    
        const subTotal = quantity * price
        const discount = 0 // Replace with the actual discount
        const shipping = 0 // Replace with the actual shipping cost
    
        const total = subTotal - discount + shipping
    
        subTotalElement.textContent = ` ₹ ${subTotal}`
        discountElement.textContent = `₹ ${discount}`
        shippingElement.textContent = ` ₹ ${shipping}`
        totalElement.textContent = ` ${total}`
      }
    
      // Attach event listeners to the plus and minus buttons
      document.querySelector('button[onclick^="this.parentNode.querySelector(\'input[type=number]\').stepDown()"]').addEventListener('click', updateTotal)
      document.querySelector('button[onclick^="this.parentNode.querySelector(\'input[type=number]\').stepUp()"]').addEventListener('click', updateTotal)
    
      const placeOrderLink = document.getElementById('place-order-link')
      placeOrderLink.addEventListener('click', function (event) {
        event.preventDefault() // Prevent the default behavior of the link
        const totalAmount = parseInt(totalElement.innerText.replace('₹', '').replace(',', '').trim())
        sendTotalToBackend(totalAmount)
        // Add any additional logic or redirection after sending the total to the backend
      })
      // Initial update
      updateTotal()
    })
    
    // Function to send total to the backend
    function sendTotalToBackend(total) {
      fetch('/your-backend-endpoint/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({ total: total })
      })
        .then((response) => response.json())
        .then((data) => {
          console.log(data)
          // Add code to handle the response if needed
        })
        .catch((error) => {
          console.error('Error:', error)
        })
    }
  </script>
{% endblock %}
