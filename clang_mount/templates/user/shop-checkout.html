{% extends 'user/base.html' %}
{% load static %}
{% block style %}
  input[type="radio"]:checked + label.form-check-label.address-radio{ background-color: #e7fa3d61; } .address-radio.selected { background-color: #e7fa3d61; }
{% endblock %}
{% block content %}
  <main class="main">
    <section class="mt-50 mb-50">
      <div class="container">
        <div class="row">
          <div class="col-md-7">
            <div class="mb-25">
              <h4>Billing Details</h4>
            </div>

            <div class="row">
              <div class="col-md-6">
                <label for="">First name</label>
                <input type="text" value="{{ user.first_name }}" readonly />
              </div>
              <div class="col-md-6">
                <label for="">Last name</label>
                <input type="text" value="{{ user.last_name }}" readonly />
              </div>
            </div>

            <div class="row mt-3">
              <div class="col-md-6">
                <label for="">Phone number</label>
                <input type="number" value="{{ user.phone }}" readonly />
              </div>
              <div class="col-md-6">
                <label for="">Email Id</label>
                <input type="email" value="{{ user.email }}" readonly />
              </div>
            </div>

            <div class="row mt-3 mx-0">
              <p class="p-0">Select a delivery address</p>
              <div class="border rounded-4 border-dark-subtle">
                <div class="accordion accordion-flush mt-3 " id="accordionFlushExample">
                  <div class="accordion-item">
                    <h2 class="accordion-header bg-body-secondary"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">ADD ADDRESS</button></h2>
                    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                      <div class="accordion-body">
                        <form action="{% url 'cart_app:address' id=user.id %}" method="POST">
                          {% csrf_token %}
                          <div class="row">
                            <div class="form-group col-md-6">
                              <label>Address Type</label>
                              {{ address_form.address_type }}
                              {{ address_form.address_type.error }}
                            </div>
                            <div class="form-group col-md-6">
                              <label>Phone number</label>
                              {{ address_form.phone }}
                              {{ address_form.phone.error }}
                            </div>
                            <div class="form-group col-md-12">
                              <label>Address</label>
                              {{ address_form.address }}
                              {{ address_form.address.error }}
                            </div>
                            <div class="form-group col-md-3">
                              <label>Country</label>
                              {{ address_form.country }}
                              {{ address_form.country.error }}
                            </div>
                            <div class="form-group col-md-3">
                              <label>State/Region</label>
                              {{ address_form.state }}
                              {{ address_form.state.error }}
                            </div>
                            <div class="form-group col-md-3">
                              <label>City</label>
                              {{ address_form.city }}
                              {{ address_form.city.error }}
                            </div>
                            <div class="form-group col-md-3">
                              <label>Pin Code</label>
                              {{ address_form.pin_code }}
                              {{ address_form.pin_code.error }}
                            </div>
                            {% comment %} <div class="form-group col-md-3">
                              <label>Pin Code</label>
                              {{ address_form.created_At }}
                              {{ address_form.created_At.error }}
                            </div> {% endcomment %}
                            {% if address_form.errors %}
                              <div class="alert alert-danger" role="alert">
                                <strong>Error:</strong> {{ address_form.errors }}
                              </div>
                            {% endif %}
                            <div class="col-md-12">
                              <button type="submit" class="btn btn-fill-out submit" name="submit" value="Submit">Save</button>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                <p class="my-3">Your addresses</p>

                {% for address in addresses %}
                  <div class="border rounded-4 border-body-secondary bg-body-secondary mb-20">
                    <div class="ps-3 py-1 bg-body-secondary rounded-top border-bottom border-dark-subtle text-dark">{{ address.address_type|upper }}</div>
                    <input class="radio-button form-check-input m-4" type="radio" data-id="{{ address.id }}" name="flexRadioDefault" id="flexRadioDefault{{ forloop.counter }}" style="display: none;" />
                    <label class="address-radio selected form-check-label w-100 h-100 me-3 rounded-bottom rounded-4" for="flexRadioDefault{{ forloop.counter }}">
                      <p class="p-3">
                        {{ address.address }}, <br>
                        {% if address.phone is not None %}
                          {{ address.phone }}, <br>
                        {% endif %}
                        {{ address.city }},
                        {{ address.pin_code }},<br>
                        {{ address.state }},
                        {{ address.country }},
                      </p>
                    </label>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
          <div class="col-md-1"></div>
          <div class="col-md-4">
            <div class="order_review">
              <div class="mb-20">
                <h4>Your Orders</h4>
              </div>
              <form action="{% url 'order_app:order_payment' %}" method="POST">
                {% csrf_token %}
                <div class="table-responsive order_table text-center">
                  <table class="table table-bordered">
                    <tbody>
                      {% for item in items %}
                        <tr>
                          <td class="image product-thumbnail">
                            <img src="{{ item.product.thumbnail_image.url }}" alt="#" />
                          </td>
                          <td>
                            <h5><a href="shop-product-full.html">{{ item.product.product_name }}</a></h5>
                          </td>
                          <td>{{ item.quantity }} x {{ item.product.after_discount }}</td>
                        </tr>
                      {% endfor %}
                      <tr class="table-group-divider">
                        <th>SubTotal</th>
                        <td class="product-subtotal text-end" colspan="2">₹ {{ sub_total }}</td>
                        <input type="hidden" name="sub_total" value="{{ sub_total }}" />
                      </tr>
                      <tr>
                        <th>Shipping</th>
                        <td colspan="2" class="text-end">
                          {% if shipping == 0 %}
                            <em>Free Shipping</em>
                          {% else %}
                            ₹ {{ shipping }}
                            <input type="hidden" name="shipping" value="{{ shipping }}" />
                          {% endif %}
                        </td>
                      </tr>
                      <tr>
                        <th>Total</th>
                        <td colspan="2" class="product-subtotal text-end">
                          <span class="font-xl text-brand fw-900 t">₹ {{ total }}</span>
                          <input type="hidden" name="grand_total" value="{{ total }}" />
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <hr style="background-color: black;" />
                <div class="payment_method">
                  <div class="mb-25">
                    <h5>Payment</h5>
                  </div>
                  <div class="payment_option">
                    <div class="custome-radio">
                      <input class="form-check-input" required="" type="radio" name="payment" value="ONLINE_PAYMENT" id="exampleRadios4" checked="" />
                      <label class="form-check-label" for="exampleRadios4" data-bs-toggle="collapse" data-target="#checkPayment" aria-controls="checkPayment">Online payment</label>
                      <div class="form-group collapse in" id="checkPayment">
                        <p class="text-muted mt-5">Please send your cheque to Store Name, Store Street, Store Town, Store State / County, Store Postcode.</p>
                      </div>
                    </div>
                    <div class="custome-radio">
                      <input class="form-check-input" required="" type="radio" name="payment" value="COD" id="exampleRadios5" checked="" />
                      <label class="form-check-label" for="exampleRadios5" data-bs-toggle="collapse" data-target="#paypal" aria-controls="paypal">Cash on delivery</label>
                      <div class="form-group collapse in" id="paypal">
                        <p class="text-muted mt-5">Pay via PayPal; you can pay with your credit card if you don't have a PayPal account.</p>
                      </div>
                    </div>
                  </div>
                </div>
                <button type="submit" href="{% url 'order_app:order_payment' %}" class="btn btn-block bg-dark">Place Order</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  <script>
    const csrfToken = '{{ csrf_token }}'
    const updateCartUrl = '{% url "cart_app:checkout" %}'
  </script>
{% endblock %}
